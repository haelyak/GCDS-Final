---
title: "GCDS Final"
author: "Kayleah, Brian, Rebecca"
date: "2022-11-17"
output: html_document
---
```{r}
rm(list = ls(all.names = TRUE))      # remove objects in R
source("https://pastebin.com/raw/8mXH02yg")   # run and comment out after knitting
source("https://pastebin.com/raw/97NNTTzu")   # run to include in function definitions
# set the paths for project, script, and data dirs
proj_dir <- gsub("GCDS.*.Rmd", "GCDS", get_ActivePath())
proj_name = ""
r_dir    <- paste(proj_dir, "r", sep = "/")    # r subdir
data_dir <- paste(proj_dir, "data", sep = "/") # data subdir
if ( proj_name != "" & !dir.exists(paste(proj_dir, proj_name, sep = "/")) ) {
# create project dir
suppressWarnings(dir.create(paste(proj_dir, proj_name, sep = "/")))
r_dir <- gsub("/r", paste0("/", proj_name, "/r"), r_dir)
data_dir <- gsub("/data", paste0("/", proj_name, "/data"), data_dir)
# create sub directories
suppressWarnings(dir.create(r_dir))
suppressWarnings(dir.create(data_dir)) }
```


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(tidyverse)  # data manipulation
library(cluster)    # clustering algorithms
library(factoextra) # clustering algorithms & visualization

```

# **DATA PREPARATION**

## General Game Survey

### *Cleaning/Tidying Data*

1. Read the .csv into an object  
2. Filter out bad/incomplete data (i.e., the invalid 99999 id and the unfinished responses)  
3. Select only relevant columns (i.e., code ID and Game variables)  
4. Convert all '99' error values into NAs
5. Remove columns with NAs in them
6. Remove the automated row numbers because they mess with k-means clustering

```{r GS: Data Cleaning}
# General Survey, cleaned (GS)
GS <- read.csv("GCDS22_11-15_numeric.csv")

GS <- GS %>% 
  filter(code < 2100, Finished == 1) %>%
  select(-c(1:17), -id) %>%
  mutate(across(.fns = ~na_if(.,99)))

GS <- GS %>% select_if(~ !any(is.na(.)))

row.names(GS) <- GS$code

GS <- GS[, -1]

view(GS)

```

### *Gathering continuous variables for clustering*

We filter out the binary outcome variables (All the Pleasure__1:Pleasure__10 and Design_1:PLAY variables)   from GS and create a new DF called GS_c. This prepares the data for clustering.

Qualtrics returns numeric data as character objects, so we have to convert all of them to numeric in order to calculate means.

```{r GS: selecting continuous variables }
# General Survey w/ only continuous variables (GS_c)
GS_c <- GS %>% 
  select(!c(Pleasure__1:Pleasure__11, Challenge.1, FREQUENCY)) 

GS_c <- mutate_all(GS_c, function(x) as.numeric(as.character(x)))

```


## Individual post-gameplay responses

### *Cleaning/Tidying Data*

1. Read game csv into an object  
2. Slice out the rows that aren't participant data   
3. Select only relevant columns (i.e., code ID and response variables)  

```{r Individual Games}
# Love Letter (LL)
LL <- readr::read_csv("LoveLetter_11-15_numeric.csv")

LL <- LL %>%
  slice(3:42) %>% 
  select(-c(1:17))

# Taco Cat Goat Cheese Pizza (TC)
TC <- readr::read_csv("TacoCat_11-15_numeric.csv")

TC <- TC %>%
  slice(3:37) %>% 
  select(-c(1:17))

```

# **Clustering**

## General Game Survey

### *K-means clustering on the General Game Survey*

Set a "random" seed value so the data is reproducible

Run the k-means algorithm with a specified number of clusters and a number of trials. 25 ensures that the best option is chosen.

```{r}
set.seed(123)
k5 <- kmeans(GS_c, 5, nstart = 25)
k4 <- kmeans(GS_c, 4, nstart = 25)
k3 <- kmeans(GS_c, 3, nstart = 25)
k2 <- kmeans(GS_c, 2, nstart = 25)

# Print the results
str(k4)
print(k4)

```

Visualize the clusters

```{r}
# plots to compare
p1 <- fviz_cluster(k2, geom = "point", data = GS_c) + ggtitle("k = 2")
p2 <- fviz_cluster(k3, geom = "point",  data = GS_c) + ggtitle("k = 3")
p3 <- fviz_cluster(k4, geom = "point",  data = GS_c) + ggtitle("k = 4")
p4 <- fviz_cluster(k5, geom = "point",  data = GS_c) + ggtitle("k = 5")

library(gridExtra)
grid.arrange(p1, p2, p3, p4, nrow = 2)

```


